---
title: "Debt and Interest in the European Union"
subtitle: "An Automatically Updated Overview of the EU's Finances"
author: Dr Michal Ovádek
output: 
  html_document:
    df_print: paged
    number_sections: true
    toc: true
    toc_float: true
    theme: sandstone
    highlight: espresso
---

<style>
body {
text-align: justify}
</style>

<style type="text/css">
  body{
  font-size: 13pt;
}
</style>

<style>
.tocify-extend-page {
  height: 30px !important;
}
</style>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      warning = FALSE,
                      message = FALSE,
                      error = FALSE,
                      fig.width = 9,
                      fig.height = 6)
```


```{r initialdata, include=FALSE}

# packages
library(ggplot2)
library(ggforce)
library(ggiraph)
library(dplyr)
library(purrr)
library(tidyr)
library(stringr)
library(forcats)
library(rmarkdown)
library(modelsummary)
library(DT)
library(lubridate)

# seed
set.seed(35239)

# current date
date_now <- Sys.Date()
date_now_f <- str_remove(format(date_now, "%d %B %Y"), "^0")
day_now <- as.integer(str_sub(date_now, 9, 10))
year_now <- as.integer(str_sub(date_now, 1, 4))

# citation
cit_page <- paste("Michal Ovádek, '",rmarkdown::metadata$title,"', available at https://michalovadek.github.io/eufinance/, accessed on ", date_now_f,
                  sep = "")

#### download data ####

# ecb api url
ecb_api <- "https://data-api.ecb.europa.eu/service/data/"

# time period argument
"startPeriod=2004-09-06&endPeriod=2023-12-31"

# Euro area bond yields, spot rates
yields_l <- list()

# 1 year, 5 year, 10 year maturities
for (Y in c(1, 5, 10)){
  
  # construct URL
  url = str_c(
  ecb_api,
  "YC/B.U2.EUR.4F.G_N_A.SV_C_YM.SR_",
  Y,
  "Y?startPeriod=2004-09-06&",
  "endPeriod=",
  as.character(date_now),
  "&format=csvdata")
  
  yields_l[[as.character(Y)]] <- read.csv(url)
  
}

# consolidate euro area yields
yields_euroarea <- bind_rows(yields_l) |> 
  select(DATA_TYPE_FM, TIME_PERIOD, OBS_VALUE, TITLE) |> 
  as_tibble()

```

<br>

Data from [ECB API](https://data.ecb.europa.eu/help/api/).

# Euro Area Government Bond Yields

```{r euroareabondyields}
# iplot
iplot_yields_euro <- yields_euroarea |> 
  mutate(tooltip = case_when(
     DATA_TYPE_FM == "SR_1Y" ~ "1-year maturity",
     DATA_TYPE_FM == "SR_5Y" ~ "5-year maturity",
     DATA_TYPE_FM == "SR_10Y" ~ "10-year maturity",
     T ~ NA_character_
  )) |> 
  ggplot(aes(x = as.Date(TIME_PERIOD), y = OBS_VALUE)) +
  geom_line_interactive(aes(color = DATA_TYPE_FM,
                            tooltip = tooltip,
                            data_id = DATA_TYPE_FM), 
                        linewidth = 0.2,
                        show.legend = FALSE) + 
  scale_y_continuous(labels = function(x) paste0(x, "%")) +
  scale_color_manual_interactive(values = c("#98EDDF","#2D5C54","#5AB8A8")) +
  theme_minimal() +
  theme(panel.grid = element_line(color = "grey96", linewidth = 0.2),
        strip.background = element_rect(fill = "grey95", color = "grey92"),
        plot.title = element_text(face = "bold")) +
  facet_zoom(xy = between(as.Date(TIME_PERIOD), date_now-365, date_now),
             horizontal = FALSE,
             zoom.size = 0.5) +
  labs(x = NULL, y = "Yield",
       title = "Euro Area Government Bond Yields",
       subtitle = "Daily spot rates, triple A issuers only")

# interactive
girafe(ggobj = iplot_yields_euro,
       fonts = list(sans = "Arial"),
       #width_svg = 12,
       #height_svg = 8,
       options = list(opts_sizing(rescale = TRUE),
                      opts_toolbar(saveaspng = FALSE),
                      opts_tooltip(css = "background-color:gray;color:white;font-style:italic;padding:9px;border-radius:5px;font-size:15px;",
                                   use_fill = TRUE),
                      opts_hover_inv(css = "opacity:0.2;"),
                      opts_hover(css = ""))
)
```

Typically, lending money for longer periods of time is associated with higher interest rates. When shorter-term yields overtake longer-term yields, we speak of an inverted yield curve. Yield curve inversion is historically predictive of recessions.

# Euro Area Key Interest Rates

The ECB's primary mandate is price stability. Its long-term inflation target is 2% (year-on-year).

```{r eurokeyinterest}

## key ECB interest rate
# construct URL
url = str_c(
  ecb_api,
  "FM/B.U2.EUR.4F.KR.MRR_FR.LEV",
  "?startPeriod=1998-01-01&",
  "endPeriod=",
  as.character(date_now),
  "&format=csvdata"
)

# main refinancing operations
key_interest_rate <- read.csv(url) |> 
  select(TIME_PERIOD, OBS_VALUE, TITLE)

## inflation
# construct URL
url = str_c(
  ecb_api,
  "ICP/M.U2.N.000000.4.ANR",
  "?startPeriod=1998-01-01&",
  "endPeriod=",
  as.character(date_now),
  "&format=csvdata"
)

# year-on-year inflation 
inflation_rate <- read.csv(url) |> 
  select(TIME_PERIOD, OBS_VALUE, TITLE) |> 
  mutate(date = as.character(lubridate::ym(TIME_PERIOD)))

# days
days <- seq.Date(from = as.Date("1998-01-01"), to = date_now, by = "day")

# interest rate and inflation
rates <- tibble(date = as.character(days)) |> 
  left_join(inflation_rate |> select(-TITLE, -TIME_PERIOD)) |> 
  fill(OBS_VALUE) |> 
  rename(inflation = OBS_VALUE) |> 
  left_join(key_interest_rate |> select(-TITLE), by = c("date" = "TIME_PERIOD")) |> 
  fill(OBS_VALUE) |> 
  rename(ecb_rate = OBS_VALUE)

# iplot
iplot_rates <- rates |> 
  pivot_longer(cols = -date) |> 
  drop_na() |> 
  mutate(tooltip = ifelse(name == "inflation", "Harmonised index of consumer prices, year-on-year change", "Interest rate on main refinancing operations")) |> 
  ggplot(aes(x = as.Date(date), y = value)) +
  geom_step_interactive(aes(color = name, tooltip = tooltip, data_id = name),
                        linewidth = 0.25,
                        show.legend = FALSE) +
  geom_hline(yintercept = 2, lty = 2, color = "grey30") +
  annotate(geom = "text", label = "2% target", x = as.Date("1997-01-01"), y = 2.3,
           fontface = "italic", size = 3) +
  scale_x_date(date_breaks = "5 years", date_labels = "%Y") +
  scale_y_continuous(labels = function(x) paste0(x, "%")) +
  scale_color_manual_interactive(values = c("#CDC7DD", "#758055")) +
  theme_minimal() +
  theme(panel.grid = element_line(color = "grey96", linewidth = 0.2),
        strip.background = element_rect(fill = "grey95", color = "grey92"),
        plot.title = element_text(face = "bold")) +
  labs(x = NULL, y = "Rate",
       title = "Key Interest Rate and Inflation",
       subtitle = "Main refinancing operations and index of consumer prices")

girafe(ggobj = iplot_rates,
       fonts = list(sans = "Arial"),
       #width_svg = 12,
       #height_svg = 8,
       options = list(opts_sizing(rescale = TRUE),
                      opts_toolbar(saveaspng = FALSE),
                      opts_tooltip(css = "background-color:gray;color:white;font-style:italic;padding:9px;border-radius:5px;font-size:15px;",
                                   use_fill = TRUE),
                      opts_hover_inv(css = "opacity:0.1;"),
                      opts_hover(css = ""))
)

```

In times of rising inflation, the ECB's main countervailing instrument is increasing key interest rates.

# Cite

Cite this document as `r cit_page`.
